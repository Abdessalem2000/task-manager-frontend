"use strict";(()=>{var e={};e.id=806,e.ids=[806],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},3262:(e,t,r)=>{r.r(t),r.d(t,{config:()=>D,default:()=>m,routeModule:()=>f});var o={};r.r(o),r.d(o,{default:()=>g});var s=r(1802),n=r(7153),a=r(6249);let l=require("mongoose");var d=r.n(l);let i=async()=>{try{if(1!==d().connection.readyState){if(console.log("\uD83D\uDD0D MONGODB_URI check:",process.env.MONGODB_URI?"DEFINED":"UNDEFINED"),console.log("\uD83D\uDD0D MONGODB_URI length:",process.env.MONGODB_URI?.length||0),!process.env.MONGODB_URI)throw Error("MONGODB_URI is not defined in environment variables");await d().connect(process.env.MONGODB_URI),console.log("✅ MongoDB connected successfully")}}catch(e){throw console.error("❌ MongoDB connection failed:",e.message),e}},u=new(d()).Schema({name:{type:String,required:!0},completed:{type:Boolean,default:!1},priority:{type:String,enum:["low","medium","high"],default:"medium"},category:{type:String,enum:["work","personal","shopping"],default:"work"},user:{type:String,required:!0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),c=d().models.Task||d().model("Task",u);async function g(e,t){if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),t.setHeader("Access-Control-Allow-Credentials","true"),"OPTIONS"===e.method)return t.status(200).end();let r=!1;try{await i(),r=!0,console.log("\uD83D\uDD25 Database connection established")}catch(e){console.error("\uD83D\uDD25 Database connection failed:",e.message)}if("POST"===e.method)try{let o;console.log("POST /api/tasks - Request received"),console.log("Request body:",e.body);let{name:s,priority:n="medium",category:a="work"}=e.body||{};if(!s||""===s.trim())return console.log("Task name validation failed"),t.status(400).json({error:"Task name is required"});return r?(o=new c({name:s.trim(),priority:n,category:a,user:"default-user"}),await o.save(),console.log("✅ Task saved to MongoDB:",o)):(o={_id:Date.now().toString(),name:s.trim(),priority:n,category:a,completed:!1,user:"default-user",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),_mock:!0},console.log("⚠️ Task created as mock (no DB):",o)),t.status(201).json({...o,dbConnected:r})}catch(e){return console.error("POST /api/tasks - Error:",e),t.status(500).json({error:"Internal server error",details:e.message})}if("GET"===e.method)try{let e;return console.log("GET /api/tasks - Fetching tasks"),r?(e=await c.find({user:"default-user"}).sort({createdAt:-1}),console.log("✅ Tasks fetched from MongoDB:",e.length)):(e=[{_id:"1",name:"Sample Task 1",priority:"medium",category:"work",completed:!1,user:"default-user",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),_mock:!0},{_id:"2",name:"Sample Task 2",priority:"high",category:"personal",completed:!0,user:"default-user",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),_mock:!0}],console.log("⚠️ Mock tasks returned (no DB):",e.length)),t.status(200).json({tasks:e,dbConnected:r})}catch(e){return console.error("GET /api/tasks - Error:",e),t.status(500).json({error:"Internal server error",details:e.message})}if("DELETE"===e.method)try{let{taskId:o}=e.query;if(!o)return t.status(400).json({error:"Task ID is required"});if(r){let e=await c.findByIdAndDelete(o);if(!e)return t.status(404).json({error:"Task not found"});console.log("✅ Task deleted from MongoDB:",e)}else console.log("⚠️ Mock task deleted (no DB):",o);return t.status(200).json({message:"Task deleted successfully",dbConnected:r})}catch(e){return console.error("DELETE /api/tasks - Error:",e),t.status(500).json({error:"Internal server error",details:e.message})}if("PUT"===e.method)try{let o;let{taskId:s}=e.query,{completed:n}=e.body;if(!s)return t.status(400).json({error:"Task ID is required"});if(r){if(!(o=await c.findByIdAndUpdate(s,{completed:n,updatedAt:new Date},{new:!0})))return t.status(404).json({error:"Task not found"});console.log("✅ Task updated in MongoDB:",o)}else o={_id:s,name:"Updated Task",completed:n,user:"default-user",updatedAt:new Date().toISOString(),_mock:!0},console.log("⚠️ Mock task updated (no DB):",o);return t.status(200).json({...o,dbConnected:r})}catch(e){return console.error("PUT /api/tasks - Error:",e),t.status(500).json({error:"Internal server error",details:e.message})}return t.setHeader("Allow",["GET","POST","PUT","DELETE","OPTIONS"]),t.status(405).end(`Method ${e.method} Not Allowed`)}let m=(0,a.l)(o,"default"),D=(0,a.l)(o,"config"),f=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/tasks",pathname:"/api/tasks",bundlePath:"",filename:""},userland:o})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=3262);module.exports=r})();